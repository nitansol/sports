<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi-Language Video.js Player</title>

  <!-- Video.js CSS (cdnjs) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/video.js/8.23.1/video-js.min.css">

  <style>
    html, body { height: 100%; }
    body{
      margin:0;
      background:#121212;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      box-sizing:border-box;
      font-family: Arial, sans-serif;
    }
    .wrap{ width:100%; max-width:1100px; }
    .video-js{ width:100% !important; border-radius:14px; overflow:hidden; }
    .vjs-16-9{ padding-top:56.25%; }
    .video-js .vjs-control-bar{ background: rgba(0,0,0,0.65); }
    .video-js .vjs-big-play-button{ background: rgba(0,0,0,0.55); border:0; }
    .video-js .vjs-lang-button{ width:3.2em; }
    .video-js .vjs-lang-button svg{ width:18px; height:18px; fill:#ffd400; }
  </style>
</head>

<body>
  <div class="wrap">
    <video
      id="my-video"
      class="video-js vjs-big-play-centered vjs-fluid vjs-16-9"
      controls
      preload="auto"
      playsinline
      crossorigin="anonymous"
    >
      <source src="https://footballmultilin.s3.us-west-2.amazonaws.com/main.m3u8" type="application/x-mpegURL" />
    </video>
  </div>

  <!-- Video.js loader with fallback -->
  <script>
    function loadScript(src, onload) {
      const s = document.createElement('script');
      s.src = src;
      s.onload = onload;
      s.onerror = () => console.warn("Failed to load:", src);
      document.head.appendChild(s);
    }

    function boot() {
      if (!window.videojs) {
        console.error("Video.js still not available after trying CDNs.");
        return;
      }

      // --- Yellow headphone language button ---
      (function(videojs){
        const MenuButton = videojs.getComponent('MenuButton');
        const MenuItem   = videojs.getComponent('MenuItem');

        class LangMenuItem extends MenuItem {
          constructor(player, options){
            super(player, options);
            this.track_ = options.track;

            const tracks = player.audioTracks && player.audioTracks();
            if (tracks) tracks.addEventListener('change', () => this.update());
            this.update();
          }
          handleClick(){
            super.handleClick();
            const tracks = this.player().audioTracks && this.player().audioTracks();
            if (!tracks) return;
            for (let i=0;i<tracks.length;i++){
              tracks[i].enabled = (tracks[i] === this.track_);
            }
          }
          update(){ this.selected(!!(this.track_ && this.track_.enabled)); }
        }

        class LangMenuButton extends MenuButton {
          constructor(player, options){
            super(player, options);
            this.controlText('Language');
            this.el().classList.add('vjs-lang-button');

            const ph = this.el().querySelector('.vjs-icon-placeholder');
            if (ph){
              ph.innerHTML = `
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 3a9 9 0 0 0-9 9v6a3 3 0 0 0 3 3h2v-8H6a6 6 0 0 1 12 0h-2v8h2a3 3 0 0 0 3-3v-6a9 9 0 0 0-9-9zm-6 18a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h1v8H6zm12 0h-1v-8h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1z"/>
                </svg>`;
            }

            this.on(player, 'loadedmetadata', () => this.refreshMenu_());
            this.on(player, 'loadstart',      () => this.refreshMenu_());
          }

          createItems(){
            const tracks = this.player().audioTracks && this.player().audioTracks();
            const items = [];

            if (!tracks || tracks.length === 0){
              items.push(new MenuItem(this.player(), { label:'No alternate audio tracks', selectable:false }));
              return items;
            }

            for (let i=0;i<tracks.length;i++){
              const t = tracks[i];
              const label = t.label || t.language || `Audio ${i+1}`;
              items.push(new LangMenuItem(this.player(), { label, selectable:true, track:t }));
            }
            return items;
          }

          refreshMenu_(){
            if (this.menu){
              this.menu.dispose();
              this.menu = this.createMenu();
              this.addChild(this.menu);
            }
          }
        }

        videojs.registerComponent('LangMenuButton', LangMenuButton);
      })(window.videojs);

      // --- Player init ---
      const player = window.videojs('my-video', {
        controls: true,
        fluid: true,
        autoplay: false,
        preload: 'auto',
        playbackRates: [0.5, 1, 1.25, 1.5, 2],
        controlBar: {
          children: [
            'playToggle',
            'volumePanel',
            'currentTimeDisplay',
            'timeDivider',
            'durationDisplay',
            'progressControl',
            'liveDisplay',
            'LangMenuButton',
            'playbackRateMenuButton',
            'fullscreenToggle'
          ]
        },
        html5: { vhs: { overrideNative: false } }
      });

      player.on('error', () => console.log('Video.js error:', player.error()));
    }

    loadScript("https://cdnjs.cloudflare.com/ajax/libs/video.js/8.23.1/video.min.js", () => {
      if (window.videojs) return boot();
      loadScript("https://cdn.jsdelivr.net/npm/video.js@8.23.1/dist/video.min.js", boot);
    });
  </script>
</body>
</html>
