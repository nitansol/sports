<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi-Language Video.js Player</title>

  <!-- Video.js CSS (cdnjs) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/video.js/8.23.1/video-js.min.css">

  <style>
    html, body { height: 100%; }

    body{
      margin:0;
      background:#121212;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      box-sizing:border-box;
      font-family: Arial, sans-serif;
      color:#d9d9d9;
    }

    .wrap{
      width:100%;
      max-width:1100px;
    }

    /* BIG responsive player */
    .video-js{
      width:100% !important;
      border-radius:14px;
      overflow:hidden;
      box-shadow: 0 14px 50px rgba(0,0,0,.45);
    }
    .vjs-16-9{ padding-top:56.25%; }

    /* Dark control bar */
    .video-js .vjs-control-bar{
      background: rgba(0,0,0,0.65);
    }
    .video-js .vjs-big-play-button{
      background: rgba(0,0,0,0.55);
      border:0;
    }

    /* Force control bar to ALWAYS be visible (no fade-out) */
    .video-js .vjs-control-bar,
    .video-js.vjs-user-inactive .vjs-control-bar,
    .video-js .vjs-control-bar.vjs-fade-out{
      opacity: 1 !important;
      visibility: visible !important;
      transform: none !important;
      transition: none !important;
    }

     /* Capitalize the first letter of the language text */
        .vjs-menu-item .vjs-menu-item-text {
            text-transform: capitalize;
        }

    /* Yellow headphone button */
    .video-js .vjs-lang-button{ width:5.2em; }
    .video-js .vjs-lang-button svg{ width:20px; height:20px; fill:#ffd400; }

    /* Notice under player (faithtube-like) */
    .notice{
      margin-top: 10px;
      text-align:center;
      font-size: 14px;
      line-height: 1.4;
      opacity: 0.95;
    }
    .notice .yellow{ color:#ffd400; font-weight:700; }
    .notice .sub{
      margin-top: 6px;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <video
      id="my-video"
      class="video-js vjs-big-play-centered vjs-fluid vjs-16-9"
      controls
      autoplay
      preload="auto"
      playsinline
      crossorigin="anonymous"
    >
      <source src="https://footballmultilin.s3.us-west-2.amazonaws.com/main.m3u8" type="application/x-mpegURL" />
    </video>

    <div class="notice">
      Tap <span class="yellow">Yellow headphone</span> icon to change language
      
    </div>
  </div>

  <!-- Video.js loader with fallback -->
  <script>
    function loadScript(src, onload) {
      const s = document.createElement('script');
      s.src = src;
      s.onload = onload;
      s.onerror = () => console.warn("Failed to load:", src);
      document.head.appendChild(s);
    }

    function boot() {
      if (!window.videojs) {
        console.error("Video.js still not available after trying CDNs.");
        return;
      }

      // ----- Yellow headphone language button (Audio Track switcher) -----
      (function(videojs){
        const MenuButton = videojs.getComponent('MenuButton');
        const MenuItem   = videojs.getComponent('MenuItem');

        class LangMenuItem extends MenuItem {
          constructor(player, options){
            super(player, options);
            this.track_ = options.track;

            const tracks = player.audioTracks && player.audioTracks();
            if (tracks) tracks.addEventListener('change', () => this.update());
            this.update();
          }

          handleClick(){
            super.handleClick();

            const player = this.player();
            const tracks = player.audioTracks && player.audioTracks();
            if (!tracks) return;

            // Enable only the selected track
            for (let i=0;i<tracks.length;i++){
              tracks[i].enabled = (tracks[i] === this.track_);
            }

            // Auto-close the menu after a few seconds
            setTimeout(() => {
              const btn = player.controlBar && player.controlBar.getChild('LangMenuButton');
              if (btn && typeof btn.unpressButton === 'function') {
                btn.unpressButton(); // closes menu
              }
            }, 2500);
          }

          update(){
            this.selected(!!(this.track_ && this.track_.enabled));
          }
        }

        class LangMenuButton extends MenuButton {
          constructor(player, options){
            super(player, options);
            this.controlText('Language');
            this.el().classList.add('vjs-lang-button');

            const ph = this.el().querySelector('.vjs-icon-placeholder');
            if (ph){
              ph.innerHTML = `
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 3a9 9 0 0 0-9 9v6a3 3 0 0 0 3 3h2v-8H6a6 6 0 0 1 12 0h-2v8h2a3 3 0 0 0 3-3v-6a9 9 0 0 0-9-9zm-6 18a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h1v8H6zm12 0h-1v-8h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1z"/>
                </svg>`;
            }

            this.on(player, 'loadedmetadata', () => this.refreshMenu_());
            this.on(player, 'loadstart',      () => this.refreshMenu_());
          }

          createItems(){
            const player = this.player();
            const tracks = player.audioTracks && player.audioTracks();
            const items = [];

            if (!tracks || tracks.length === 0){
              items.push(new MenuItem(player, { label:'No alternate audio tracks', selectable:false }));
              return items;
            }

            for (let i=0;i<tracks.length;i++){
              const t = tracks[i];
              const label = t.label || t.language || `Audio ${i+1}`;
              items.push(new LangMenuItem(player, { label, selectable:true, track:t }));
            }
            return items;
          }

          refreshMenu_(){
            if (this.menu){
              this.menu.dispose();
              this.menu = this.createMenu();
              this.addChild(this.menu);
            }
          }
        }

        videojs.registerComponent('LangMenuButton', LangMenuButton);
      })(window.videojs);

      // ----- Player init -----
      const player = window.videojs('my-video', {
        controls: true,
        fluid: true,
        autoplay: false,
        preload: 'auto',

        // ✅ Keep control bar visible
        inactivityTimeout: 0,

        // ✅ Remove playback rate entirely (no menu button + no rates)
        controlBar: {
          children: [
            'playToggle',
            'volumePanel',
            'currentTimeDisplay',
            'timeDivider',
            'durationDisplay',
            'progressControl',
            'liveDisplay',
            'LangMenuButton',
            'fullscreenToggle'
          ]
        },

        html5: { vhs: { overrideNative: false } }
      });

      player.on('error', () => console.log('Video.js error:', player.error()));
    }

    loadScript("https://cdnjs.cloudflare.com/ajax/libs/video.js/8.23.1/video.min.js", () => {
      if (window.videojs) return boot();
      loadScript("https://cdn.jsdelivr.net/npm/video.js@8.23.1/dist/video.min.js", boot);
    });
  </script>
</body>
</html>
